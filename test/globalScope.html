<html>
<head>
<script src="../lib/tmlib.js"></script>
<script src="../src/main/bulletml.js"></script>
<script src="../src/main/bulletml.walker.js"></script>
<script src="../src/main/bulletml.dsl.js"></script>
<script src="../src/main/bulletml.tmlib.js"></script>
<script>
tm.main(function() {
    var app = tm.app.CanvasApp("#app");
    app.resize(200, 200);

    var scene = app.currentScene;

    var me = tm.app.CircleShape(10, 10);
    me.setPosition(100, 190).addChildTo(scene);

    var e0 = tm.app.CircleShape(10, 10);
    e0.setPosition(50, 10).addChildTo(scene);

    var e1 = tm.app.CircleShape(10, 10);
    e1.setPosition(150, 10).addChildTo(scene);

    bulletml.dsl();
    var pattern0 = tm.bulletml.AttackPattern(new bulletml.Root({
        "top": action([
            repeat(100, [
                fire(direction("-30 + $rand*60"), bullet),
                wait("$interval"),
            ]),
        ]),
    }));
    var pattern1 = tm.bulletml.AttackPattern(new bulletml.Root({
        "top": action([
            repeat(100, [
                fire(direction("-30 + $rand*60"), bullet),
                wait("$interval*2"),
            ]),
        ]),
    }));

    bulletml.Walker.globalScope["$interval"] = 30;

    e0.onenterframe = pattern0.createTicker({
        target: me,
    });
    e1.onenterframe = pattern1.createTicker({
        target: me,
    });

    scene.update = function() {
        // 発射間隔を徐々に短くしていく
        bulletml.Walker.globalScope["$interval"] -= 0.1;
    };

    app.run();
});
</script>
</head>
<body>
<canvas id="app"></canvas>
</body>
</html>
