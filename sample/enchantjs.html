<!doctype html>
<html lang="ja">
<head>
<meta charset=UTF-8>
</head>
<body style="margin:0">
<script src="../lib/enchant.js"></script>
<script src="../build/bulletml.min.js"></script>
<script src="../src/main/bulletml.enchant.js"></script>
<script>
var C5IMG = "../lib/chara5.png";
var C6IMG = "../lib/chara6.png";

enchant();
window.onload = function() {
    var core = new Core(500, 500);
    core.preload(C5IMG, C6IMG);
    core.onload = function() {
        
        var scene = core.currentScene;
        scene.backgroundColor = "black";

        

        var player = new Sprite(32, 32);
        player.moveTo(250-16, 400);
        player.image = core.assets[C5IMG];
        player.frame = 28;
        player.speed = 4;
        player.onenterframe = function() {
            this.frame = 27 + [1, 0, 1, 2][parseInt(this.age / 5) % 4];

            if (core.input.left) this.x -= this.speed;
            else if (core.input.right) this.x += this.speed;
            if (core.input.up) this.y -= this.speed;
            else if (core.input.down) this.y += this.speed;
        };
        scene.addChild(player);



        var enemy = new Sprite(32, 32);
        enemy.moveTo(250-16, 100);
        enemy.scale(2, 2);
        enemy.image = core.assets[C6IMG];
        enemy.frame = 4;
        enemy.onenterframe = function() {
            this.frame = 3 + [1, 0, 1, 2][parseInt(this.age / 5) % 4];
        };
        scene.addChild(enemy);



        enemy.startDanmaku(danmaku1);



    };
    core.start();
};

// 弾幕パターンをBulletML DSLで記述
bulletml.dsl();
var danmaku1 = new bulletml.Root({
    top: action([
        repeat(999, [
            repeat(30, [
                fire(direction(12, "sequence"), speed(5), bullet(actionRef("b"))),
                repeat(9-1, [
                    fire(direction(360/9, "sequence"), speed(5), bullet(actionRef("b"))),
                ]),
                wait(2),
            ]),
            wait(30),
            repeat(30, [
                fire(direction(-12, "sequence"), speed(5), bullet(actionRef("b"), {color:"hsl(220, 60%, 80%)"})),
                repeat(9-1, [
                    fire(direction(360/9, "sequence"), speed(5), bullet(actionRef("b"), {color:"hsl(220, 60%, 80%)"})),
                ]),
                wait(2),
            ]),
            wait(30),
        ]),
    ]),
    b: action([
        changeSpeed(speed(1), 30),
        wait(30),
        changeDirection(direction(0, "aim"), 60),
        changeSpeed(speed(3), 30),
        wait(50),
        vanish(),
        fire(speed(2), bullet({color:"hsl(50, 60%, 80%)"}))
    ]),
});
</script>
</body>
</html>
